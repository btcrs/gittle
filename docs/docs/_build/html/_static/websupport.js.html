<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html;charset=utf-8">
  <title>. documentation: _build/html/_static/websupport.js</title>
  <link rel="stylesheet" href="../../../pyccoon.css">
</head>
<body>
<div id='container' >
  <div id="footer">
    <span id="project-name">
        <a class="btn" href="../../../index.html">. documentation</a>
    </span>
    <a class="btn" class="source source-1" href="#top">Back to top</a>
    <div class="generation-time">
        Generated at
        <code>2017-07-26 17:18</code>
        by a diligent
        <a target="_blank" href="http://ckald.github.io/pyccoon/" title="Pyccoon: side-to-side documentation generator">
            <img id="pyccoon-icon" src="../../../pyccoon_icon.svg" alt="Pyccoon: side-to-side documentation generator" />pyccoon</a>
    </div>
  </div>
  <a id="top"></a>
  <div class='section'>
    <div class='docs nav'>
      <nav id="breadcrumbs">/ <a href="websupport.js.html/../../../../index.html">.</a> / <a href="websupport.js.html/../../../index.html">_build</a> / <a href="websupport.js.html/../../index.html">html</a> / <a href="websupport.js.html/../index.html">_static</a> / websupport.js</nav>
      <ul id="children"></ul>
    </div>
  </div>
  <div id="everything" class='clearall'>
    <div id="background"></div>
    <div class='section'>
    <a id="section-0" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-0'>#</a>
          </div>
          <p>websupport.js
 ~~~~~~~~~~~~~</p>
<p>sphinx.websupport utilities for all documentation.</p>
<p><span class="pydoc pydoc-copyright"><span>copyright</span></span> Copyright 2007-2017 by the Sphinx team, see AUTHORS.
 <span class="pydoc pydoc-license"><span>license</span></span> BSD, see LICENSE for details.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autogrow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-1" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-1'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">textarea</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autogrow</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">(</span><span class="nx">textarea</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">focus</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-2" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-2'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">textarea</span><span class="p">.</span><span class="nx">interval</span> <span class="o">=</span> <span class="nx">setInterval</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autogrow</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">textarea</span><span class="p">);</span>
        <span class="p">},</span> <span class="mi">500</span><span class="p">);</span>
      <span class="p">})</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-3" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-3'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="p">.</span><span class="nx">blur</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">clearInterval</span><span class="p">(</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">interval</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">};</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-4" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-4'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autogrow</span><span class="p">.</span><span class="nx">resize</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">textarea</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">lineHeight</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">textarea</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;line-height&#39;</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">textarea</span><span class="p">.</span><span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">columns</span> <span class="o">=</span> <span class="nx">textarea</span><span class="p">.</span><span class="nx">cols</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">lineCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">lines</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">lineCount</span> <span class="o">+=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">ceil</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">length</span> <span class="o">/</span> <span class="nx">columns</span><span class="p">)</span> <span class="o">||</span> <span class="mi">1</span><span class="p">;</span>
    <span class="p">});</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">lineHeight</span> <span class="o">*</span> <span class="p">(</span><span class="nx">lineCount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="nx">textarea</span><span class="p">).</span><span class="nx">css</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-5" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-5'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">$</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">comp</span><span class="p">,</span> <span class="nx">by</span><span class="p">;</span>

  <span class="kd">function</span> <span class="nx">init</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">initEvents</span><span class="p">();</span>
    <span class="nx">initComparator</span><span class="p">();</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">initEvents</span><span class="p">()</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.comment-close&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">hide</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-6" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-6'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.vote&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">handleVote</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-7" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-7'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.reply&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">openReply</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-8" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-8'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.close-reply&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">closeReply</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-9" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-9'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.sort-option&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">handleReSort</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-10" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-10'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.show-proposal&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">showProposal</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-11" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-11'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.hide-proposal&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">hideProposal</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-12" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-12'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.show-propose-change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">showProposeChange</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-13" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-13'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.hide-propose-change&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">hideProposeChange</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-14" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-14'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.accept-comment&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">acceptComment</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-15" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-15'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.delete-comment&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">deleteComment</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-16" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-16'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="s1">&#39;a.comment-markup&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">toggleCommentMarkupBox</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-17" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-17'>#</a>
          </div>
          <p>Set comp, which is a comparator function used for sorting and
 inserting comments into the list.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">setComparator</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-18" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-18'>#</a>
          </div>
          <p>If the first three letters are "asc", sort in ascending order
and remove the prefix.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">by</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;asc&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">by</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span>

      <span class="nx">comp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="nx">b</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span> <span class="p">};</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-19" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-19'>#</a>
          </div>
          <p>Otherwise sort in descending order.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">comp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">b</span><span class="p">[</span><span class="nx">by</span><span class="p">]</span> <span class="o">-</span> <span class="nx">a</span><span class="p">[</span><span class="nx">by</span><span class="p">];</span> <span class="p">};</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-20" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-20'>#</a>
          </div>
          <p>Reset link styles and format the selected sort option.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.sel&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">,</span> <span class="s1">&#39;#&#39;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;sel&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;a.by&#39;</span> <span class="o">+</span> <span class="nx">by</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;href&#39;</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;sel&#39;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-21" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-21'>#</a>
          </div>
          <p>Create a comp function. If the user has preferences stored in
 the sortBy cookie, use those, otherwise use the default.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">initComparator</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">by</span> <span class="o">=</span> <span class="s1">&#39;rating&#39;</span><span class="p">;</span> <span class="c1">// Default to sort by rating.</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-22" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-22'>#</a>
          </div>
          <p>If the sortBy cookie is set, use that instead.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;sortBy=&#39;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">start</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">start</span> <span class="o">=</span> <span class="nx">start</span> <span class="o">+</span> <span class="mi">7</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">end</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span> <span class="nx">start</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">end</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">end</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
          <span class="nx">by</span> <span class="o">=</span> <span class="nx">unescape</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="nx">start</span><span class="p">,</span> <span class="nx">end</span><span class="p">));</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">setComparator</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-23" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-23'>#</a>
          </div>
          <p>Show a comment div.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">show</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ao&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ah&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span><span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">},</span> <span class="nx">opts</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">popup</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">popupTemplate</span><span class="p">,</span> <span class="nx">context</span><span class="p">)).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">popup</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea[name=&quot;proposal&quot;]&#39;</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">popup</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a.by&#39;</span> <span class="o">+</span> <span class="nx">by</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;sel&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">form</span> <span class="o">=</span> <span class="nx">popup</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#cf&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>

    <span class="nx">form</span><span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
      <span class="nx">addComment</span><span class="p">(</span><span class="nx">form</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#s&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">after</span><span class="p">(</span><span class="nx">popup</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-24" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-24'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">popup</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">getComments</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-25" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-25'>#</a>
          </div>
          <p>Hide a comment div.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">hide</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ah&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ao&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#sc&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>

    <span class="nx">div</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-26" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-26'>#</a>
          </div>
          <p>Perform an ajax request to get comments for a node
 and insert the comments into the comments tree.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">getComments</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
     <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;GET&#39;</span><span class="p">,</span>
     <span class="nx">url</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">getCommentsURL</span><span class="p">,</span>
     <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">node</span><span class="o">:</span> <span class="nx">id</span><span class="p">},</span>

     <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
       <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cl&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
       <span class="kd">var</span> <span class="nx">speed</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
       <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cf&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
         <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea[name=&quot;proposal&quot;]&#39;</span><span class="p">)</span>
         <span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">source</span><span class="p">);</span>

       <span class="k">if</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
         <span class="nx">ul</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;li&gt;No comments yet.&lt;/li&gt;&#39;</span><span class="p">);</span>
         <span class="nx">ul</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
       <span class="p">}</span> <span class="k">else</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-27" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-27'>#</a>
          </div>
          <p>If there are comments, sort them and put them in the list.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>         <span class="kd">var</span> <span class="nx">comments</span> <span class="o">=</span> <span class="nx">sortComments</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">comments</span><span class="p">);</span>
         <span class="nx">speed</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">comments</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">100</span><span class="p">;</span>
         <span class="nx">appendComments</span><span class="p">(</span><span class="nx">comments</span><span class="p">,</span> <span class="nx">ul</span><span class="p">);</span>
         <span class="nx">ul</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
       <span class="p">}</span>
       <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cn&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">(</span><span class="nx">speed</span> <span class="o">+</span> <span class="mi">200</span><span class="p">);</span>
       <span class="nx">ul</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="nx">speed</span><span class="p">);</span>
     <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-28" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-28'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>     <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
       <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Oops, there was a problem retrieving the comments.&#39;</span><span class="p">);</span>
     <span class="p">},</span>
     <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-29" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-29'>#</a>
          </div>
          <p>Add a comment via ajax and insert the comment into the comment tree.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">addComment</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">node_id</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;node&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">parent_id</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[name=&quot;parent&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea[name=&quot;comment&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">proposal</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea[name=&quot;proposal&quot;]&#39;</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">text</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Please enter a comment.&#39;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-30" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-30'>#</a>
          </div>
          <p>Disable the form that is being submitted.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea,input&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">,</span> <span class="s1">&#39;disabled&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-31" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-31'>#</a>
          </div>
          <p>Send the comment to the server.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">addCommentURL</span><span class="p">,</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">node</span><span class="o">:</span> <span class="nx">node_id</span><span class="p">,</span>
        <span class="nx">parent</span><span class="o">:</span> <span class="nx">parent_id</span><span class="p">,</span>
        <span class="nx">text</span><span class="o">:</span> <span class="nx">text</span><span class="p">,</span>
        <span class="nx">proposal</span><span class="o">:</span> <span class="nx">proposal</span>
      <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-32" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-32'>#</a>
          </div>
          <p>Reset the form.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">node_id</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">hideProposeChange</span><span class="p">(</span><span class="nx">node_id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input&#39;</span><span class="p">))</span>
          <span class="p">.</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
	<span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cl&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">node_id</span> <span class="o">||</span> <span class="nx">parent_id</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ul</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="nx">$</span><span class="p">(</span><span class="nx">ul</span><span class="p">).</span><span class="nx">empty</span><span class="p">();</span>
          <span class="nx">ul</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;empty&#39;</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">insertComment</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">comment</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">ao</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ao&#39;</span> <span class="o">+</span> <span class="nx">node_id</span><span class="p">);</span>
        <span class="nx">ao</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">).</span><span class="nx">attr</span><span class="p">({</span><span class="s1">&#39;src&#39;</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">commentBrightImage</span><span class="p">});</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">node_id</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-33" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-33'>#</a>
          </div>
          <p>if this was a "root" comment, remove the commenting box
(the user can get it back by reopening the comment popup)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ca&#39;</span> <span class="o">+</span> <span class="nx">node_id</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">();</span>
        <span class="p">}</span>
      <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-34" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-34'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">form</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea,input&#39;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
        <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Oops, there was a problem adding the comment.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-35" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-35'>#</a>
          </div>
          <p>Recursively append comments to the main comment list and children
 lists, creating the comment tree.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">appendComments</span><span class="p">(</span><span class="nx">comments</span><span class="p">,</span> <span class="nx">ul</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">comments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">createCommentDiv</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="nx">ul</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">)).</span><span class="nx">html</span><span class="p">(</span><span class="nx">div</span><span class="p">));</span>
      <span class="nx">appendComments</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">,</span> <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;ul.comment-children&#39;</span><span class="p">));</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-36" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-36'>#</a>
          </div>
          <p>To avoid stagnating data, don't store the comments children in data.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-37" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-37'>#</a>
          </div>
          <p>After adding a new comment, it must be inserted in the correct
 location in the comment tree.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">insertComment</span><span class="p">(</span><span class="nx">comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">createCommentDiv</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-38" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-38'>#</a>
          </div>
          <p>To avoid stagnating data, don't store the comments children in data.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">comment</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="nx">comment</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">ul</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cl&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">node</span> <span class="o">||</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">parent</span><span class="p">));</span>
    <span class="kd">var</span> <span class="nx">siblings</span> <span class="o">=</span> <span class="nx">getChildren</span><span class="p">(</span><span class="nx">ul</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">li</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;li&#39;</span><span class="p">));</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-39" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-39'>#</a>
          </div>
          <p>Determine where in the parents children list to insert this comment.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">for</span><span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">siblings</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">comp</span><span class="p">(</span><span class="nx">comment</span><span class="p">,</span> <span class="nx">siblings</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cd&#39;</span> <span class="o">+</span> <span class="nx">siblings</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">id</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">before</span><span class="p">(</span><span class="nx">li</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">div</span><span class="p">));</span>
        <span class="nx">li</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
        <span class="k">return</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-40" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-40'>#</a>
          </div>
          <p>If we get here, this comment rates lower than all the others,
or it is the only comment in the list.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">ul</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">li</span><span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="nx">div</span><span class="p">));</span>
    <span class="nx">li</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">acceptComment</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">acceptCommentURL</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">},</span>

      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cm&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cd&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;moderate&#39;</span><span class="p">);</span>
      <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-41" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-41'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Oops, there was a problem accepting the comment.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">deleteComment</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s1">&#39;POST&#39;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">deleteCommentURL</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-42" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-42'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cd&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">data</span> <span class="o">==</span> <span class="s1">&#39;delete&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-43" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-43'>#</a>
          </div>
          <p>Moderator mode: remove the comment and all children immediately</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>          <span class="nx">div</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">div</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
          <span class="p">});</span>
          <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-44" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-44'>#</a>
          </div>
          <p>User mode: only mark the comment as deleted</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>        <span class="nx">div</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;span.user-id:first&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;[deleted]&#39;</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;div.comment-text:first&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;[deleted]&#39;</span><span class="p">).</span><span class="nx">end</span><span class="p">()</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#cm&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #dc&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #ac&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #rc&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span>
                <span class="s1">&#39;, #sp&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #hp&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #cr&#39;</span> <span class="o">+</span> <span class="nx">id</span> <span class="o">+</span> <span class="s1">&#39;, #rl&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">comment</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">);</span>
        <span class="nx">comment</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="s1">&#39;[deleted]&#39;</span><span class="p">;</span>
        <span class="nx">comment</span><span class="p">.</span><span class="nx">text</span> <span class="o">=</span> <span class="s1">&#39;[deleted]&#39;</span><span class="p">;</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="nx">comment</span><span class="p">);</span>
      <span class="p">},</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-45" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-45'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Oops, there was a problem deleting the comment.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">showProposal</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#sp&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hp&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pr&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">hideProposal</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hp&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#sp&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pr&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">showProposeChange</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pc&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hc&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">textarea</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pt&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
    <span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="nx">textarea</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;source&#39;</span><span class="p">));</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">autogrow</span><span class="p">.</span><span class="nx">resize</span><span class="p">(</span><span class="nx">textarea</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="nx">textarea</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">hideProposeChange</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#hc&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pc&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">textarea</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#pt&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">);</span>
    <span class="nx">textarea</span><span class="p">.</span><span class="nx">val</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">removeAttr</span><span class="p">(</span><span class="s1">&#39;disabled&#39;</span><span class="p">);</span>
    <span class="nx">textarea</span><span class="p">.</span><span class="nx">slideUp</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">toggleCommentMarkupBox</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#mb&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">toggle</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-46" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-46'>#</a>
          </div>
          <p>Handle when the user clicks on a sort by link. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">handleReSort</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">classes</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;class&#39;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">classes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;sort-option&#39;</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">by</span> <span class="o">=</span> <span class="nx">classes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">setComparator</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-47" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-47'>#</a>
          </div>
          <p>Save/update the sortBy cookie.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">expiration</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">();</span>
    <span class="nx">expiration</span><span class="p">.</span><span class="nx">setDate</span><span class="p">(</span><span class="nx">expiration</span><span class="p">.</span><span class="nx">getDate</span><span class="p">()</span> <span class="o">+</span> <span class="mi">365</span><span class="p">);</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">cookie</span><span class="o">=</span> <span class="s1">&#39;sortBy=&#39;</span> <span class="o">+</span> <span class="nx">escape</span><span class="p">(</span><span class="nx">by</span><span class="p">)</span> <span class="o">+</span>
                     <span class="s1">&#39;;expires=&#39;</span> <span class="o">+</span> <span class="nx">expiration</span><span class="p">.</span><span class="nx">toUTCString</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-48" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-48'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;ul.comment-ul&#39;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">ul</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">comments</span> <span class="o">=</span> <span class="nx">getChildren</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nx">ul</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">comments</span> <span class="o">=</span> <span class="nx">sortComments</span><span class="p">(</span><span class="nx">comments</span><span class="p">);</span>
      <span class="nx">appendComments</span><span class="p">(</span><span class="nx">comments</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">ul</span><span class="p">).</span><span class="nx">empty</span><span class="p">());</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-49" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-49'>#</a>
          </div>
          <p>Function to process a vote when a user clicks an arrow.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">handleVote</span><span class="p">(</span><span class="nx">link</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">voting</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">showError</span><span class="p">(</span><span class="s2">&quot;You&#39;ll need to login to vote.&quot;</span><span class="p">);</span>
      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-50" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-50'>#</a>
          </div>
          <p>Didn't click on one of the voting arrows.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-51" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-51'>#</a>
          </div>
          <p>If it is an unvote, the new vote value is 0,
Otherwise it's 1 for an upvote, or -1 for a downvote.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">value</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">value</span> <span class="o">=</span> <span class="nx">id</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-52" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-52'>#</a>
          </div>
          <p>The data to be sent to the server.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">comment_id</span><span class="o">:</span> <span class="nx">id</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
      <span class="nx">value</span><span class="o">:</span> <span class="nx">value</span>
    <span class="p">};</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-53" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-53'>#</a>
          </div>
          <p>Swap the vote and unvote links.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">link</span><span class="p">.</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="nx">id</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span> <span class="o">?</span> <span class="s1">&#39;v&#39;</span> <span class="o">:</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">comment_id</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">show</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-54" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-54'>#</a>
          </div>
          <p>The div the comment is displayed in.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;div#cd&#39;</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">comment_id</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-55" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-55'>#</a>
          </div>
          <p>If this is not an unvote, and the other vote arrow has
already been pressed, unpress it.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">((</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">vote</span> <span class="o">===</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;d&#39;</span> <span class="o">:</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">comment_id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;d&#39;</span> <span class="o">:</span> <span class="s1">&#39;u&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;v&#39;</span> <span class="o">+</span> <span class="nx">d</span><span class="p">.</span><span class="nx">comment_id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-56" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-56'>#</a>
          </div>
          <p>Update the comments rating in the local data.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">data</span><span class="p">.</span><span class="nx">rating</span> <span class="o">+=</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">vote</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">?</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">:</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">value</span> <span class="o">-</span> <span class="nx">data</span><span class="p">.</span><span class="nx">vote</span><span class="p">);</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">vote</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
    <span class="nx">div</span><span class="p">.</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-57" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-57'>#</a>
          </div>
          <p>Change the rating text.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;.rating:first&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rating</span> <span class="o">+</span> <span class="s1">&#39; point&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">data</span><span class="p">.</span><span class="nx">rating</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;s&#39;</span><span class="p">));</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-58" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-58'>#</a>
          </div>
          <p>Send the vote information to the server.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">processVoteURL</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">d</span><span class="p">,</span>

      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">,</span> <span class="nx">textStatus</span><span class="p">,</span> <span class="nx">error</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">showError</span><span class="p">(</span><span class="s1">&#39;Oops, there was a problem casting that vote.&#39;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-59" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-59'>#</a>
          </div>
          <p>Open a reply form used to reply to an existing comment.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">openReply</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-60" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-60'>#</a>
          </div>
          <p>Swap out the reply link for the hide link</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rl&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cr&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-61" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-61'>#</a>
          </div>
          <p>Add the reply li to the children ul.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">replyTemplate</span><span class="p">,</span> <span class="p">{</span><span class="nx">id</span><span class="o">:</span> <span class="nx">id</span><span class="p">})).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cl&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">prepend</span><span class="p">(</span><span class="nx">div</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-62" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-62'>#</a>
          </div>
          <p>Setup the submit handler for the reply form.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#rf&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-63" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-63'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="p">.</span><span class="nx">submit</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
        <span class="nx">addComment</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rf&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">));</span>
        <span class="nx">closeReply</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;input[type=button]&#39;</span><span class="p">)</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-64" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-64'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>      <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">closeReply</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
      <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-65" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-65'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">div</span><span class="p">.</span><span class="nx">slideDown</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rf&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;textarea&#39;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-66" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-66'>#</a>
          </div>
          <p>Close the reply form opened with openReply.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">closeReply</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-67" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-67'>#</a>
          </div>
          <p>Remove the reply div from the DOM.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rd&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">slideUp</span><span class="p">(</span><span class="s1">&#39;fast&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span>
    <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-68" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-68'>#</a>
          </div>
          <p>Swap out the hide link for the reply link</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#cr&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#rl&#39;</span> <span class="o">+</span> <span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-69" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-69'>#</a>
          </div>
          <p>Recursively sort a tree of comments using the comp comparator.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">sortComments</span><span class="p">(</span><span class="nx">comments</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">comments</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="nx">comp</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">comments</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">sortComments</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">children</span><span class="p">);</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">comments</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-70" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-70'>#</a>
          </div>
          <p>Get the children comments from a ul. If recursive is true,
 recursively include childrens' children.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">getChildren</span><span class="p">(</span><span class="nx">ul</span><span class="p">,</span> <span class="nx">recursive</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nx">ul</span><span class="p">.</span><span class="nx">children</span><span class="p">().</span><span class="nx">children</span><span class="p">(</span><span class="s2">&quot;[id^=&#39;cd&#39;]&quot;</span><span class="p">)</span>

      <span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">comment</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="s1">&#39;comment&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">recursive</span><span class="p">)</span>
          <span class="nx">comment</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="nx">getChildren</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#cl&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">),</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">children</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">comment</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="k">return</span> <span class="nx">children</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-71" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-71'>#</a>
          </div>
          <p>Create a div to display a comment in. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">createCommentDiv</span><span class="p">(</span><span class="nx">comment</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">comment</span><span class="p">.</span><span class="nx">displayed</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">opts</span><span class="p">.</span><span class="nx">moderator</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;div class=&quot;moderate&quot;&gt;Thank you!  Your comment will show up &#39;</span>
               <span class="o">+</span> <span class="s1">&#39;once it is has been approved by a moderator.&lt;/div&gt;&#39;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-72" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-72'>#</a>
          </div>
          <p>Prettify the comment rating.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">comment</span><span class="p">.</span><span class="nx">pretty_rating</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">rating</span> <span class="o">+</span> <span class="s1">&#39; point&#39;</span> <span class="o">+</span>
      <span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">rating</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;s&#39;</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-73" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-73'>#</a>
          </div>
          <p>Make a class (for displaying not yet moderated comments differently)</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="nx">comment</span><span class="p">.</span><span class="nx">css_class</span> <span class="o">=</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">displayed</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39; moderate&#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-74" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-74'>#</a>
          </div>
          <p>Create a div for this comment.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="kd">var</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">extend</span><span class="p">({},</span> <span class="nx">opts</span><span class="p">,</span> <span class="nx">comment</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">div</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">commentTemplate</span><span class="p">,</span> <span class="nx">context</span><span class="p">));</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-75" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-75'>#</a>
          </div>
          <p>If the user has voted on this comment, highlight the correct arrow.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">vote</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">direction</span> <span class="o">=</span> <span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">vote</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="s1">&#39;u&#39;</span> <span class="o">:</span> <span class="s1">&#39;d&#39;</span><span class="p">;</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">direction</span> <span class="o">+</span> <span class="s1">&#39;v&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nx">direction</span> <span class="o">+</span> <span class="s1">&#39;u&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">moderator</span> <span class="o">||</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">text</span> <span class="o">!=</span> <span class="s1">&#39;[deleted]&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;a.reply&#39;</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">comment</span><span class="p">.</span><span class="nx">proposal_diff</span><span class="p">)</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#sp&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">moderator</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">comment</span><span class="p">.</span><span class="nx">displayed</span><span class="p">)</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#cm&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">moderator</span> <span class="o">||</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">username</span> <span class="o">==</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">username</span><span class="p">))</span>
        <span class="nx">div</span><span class="p">.</span><span class="nx">find</span><span class="p">(</span><span class="s1">&#39;#dc&#39;</span> <span class="o">+</span> <span class="nx">comment</span><span class="p">.</span><span class="nx">id</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">div</span><span class="p">;</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-76" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-76'>#</a>
          </div>
          <p>A simple template renderer. Placeholders such as &lt;%id%&gt; are replaced
 by context['id'] with items being escaped. Placeholders such as &lt;#id#&gt;
 are not escaped.</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">renderTemplate</span><span class="p">(</span><span class="nx">template</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">esc</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">));</span>

    <span class="kd">function</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">ph</span><span class="p">,</span> <span class="nx">escape</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">cur</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">ph</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">),</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">cur</span> <span class="o">=</span> <span class="nx">cur</span><span class="p">[</span><span class="k">this</span><span class="p">];</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">escape</span> <span class="o">?</span> <span class="nx">esc</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">cur</span> <span class="o">||</span> <span class="s2">&quot;&quot;</span><span class="p">).</span><span class="nx">html</span><span class="p">()</span> <span class="o">:</span> <span class="nx">cur</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-77" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-77'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>    <span class="k">return</span> <span class="nx">template</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;([%#])([\w\.]*)\1&gt;/g</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="nx">arguments</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;%&#39;</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-78" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-78'>#</a>
          </div>
          <p>Flash an error message briefly. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">showError</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;popup-error&#39;</span><span class="p">})</span>
      <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">))</span>
               <span class="p">.</span><span class="nx">attr</span><span class="p">({</span><span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;error-message&#39;</span><span class="p">}).</span><span class="nx">text</span><span class="p">(</span><span class="nx">message</span><span class="p">))</span>
      <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">fadeIn</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">delay</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">fadeOut</span><span class="p">(</span><span class="s2">&quot;slow&quot;</span><span class="p">);</span>
  <span class="p">}</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-79" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-79'>#</a>
          </div>
          <p>Add a link the user uses to open the comments popup. </p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">$</span><span class="p">.</span><span class="nx">fn</span><span class="p">.</span><span class="nx">comment</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">count</span> <span class="o">=</span> <span class="nx">COMMENT_METADATA</span><span class="p">[</span><span class="nx">id</span><span class="p">];</span>
      <span class="kd">var</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">+</span> <span class="s1">&#39; comment&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">count</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">?</span> <span class="s1">&#39;&#39;</span> <span class="o">:</span> <span class="s1">&#39;s&#39;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">image</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">commentBrightImage</span> <span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">commentImage</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">addcls</span> <span class="o">=</span> <span class="nx">count</span> <span class="o">==</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39; nocomment&#39;</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">append</span><span class="p">(</span>
          <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">href</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;sphinx-comment-open&#39;</span> <span class="o">+</span> <span class="nx">addcls</span><span class="p">,</span>
            <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;ao&#39;</span> <span class="o">+</span> <span class="nx">id</span>
          <span class="p">})</span>
            <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span>
              <span class="nx">src</span><span class="o">:</span> <span class="nx">image</span><span class="p">,</span>
              <span class="nx">alt</span><span class="o">:</span> <span class="s1">&#39;comment&#39;</span><span class="p">,</span>
              <span class="nx">title</span><span class="o">:</span> <span class="nx">title</span>
            <span class="p">}))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-80" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-80'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
              <span class="nx">show</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
            <span class="p">})</span>
        <span class="p">)</span>
        <span class="p">.</span><span class="nx">append</span><span class="p">(</span>
          <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span>
            <span class="nx">href</span><span class="o">:</span> <span class="s1">&#39;#&#39;</span><span class="p">,</span>
            <span class="s1">&#39;class&#39;</span><span class="o">:</span> <span class="s1">&#39;sphinx-comment-close hidden&#39;</span><span class="p">,</span>
            <span class="nx">id</span><span class="o">:</span> <span class="s1">&#39;ah&#39;</span> <span class="o">+</span> <span class="nx">id</span>
          <span class="p">})</span>
            <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;img&#39;</span><span class="p">)).</span><span class="nx">attr</span><span class="p">({</span>
              <span class="nx">src</span><span class="o">:</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">closeCommentImage</span><span class="p">,</span>
              <span class="nx">alt</span><span class="o">:</span> <span class="s1">&#39;close&#39;</span><span class="p">,</span>
              <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;close&#39;</span>
            <span class="p">}))</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-81" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-81'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>            <span class="p">.</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">event</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
              <span class="nx">hide</span><span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">).</span><span class="nx">substring</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
            <span class="p">})</span>
        <span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>

  <span class="kd">var</span> <span class="nx">opts</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">processVoteURL</span><span class="o">:</span> <span class="s1">&#39;/_process_vote&#39;</span><span class="p">,</span>
    <span class="nx">addCommentURL</span><span class="o">:</span> <span class="s1">&#39;/_add_comment&#39;</span><span class="p">,</span>
    <span class="nx">getCommentsURL</span><span class="o">:</span> <span class="s1">&#39;/_get_comments&#39;</span><span class="p">,</span>
    <span class="nx">acceptCommentURL</span><span class="o">:</span> <span class="s1">&#39;/_accept_comment&#39;</span><span class="p">,</span>
    <span class="nx">deleteCommentURL</span><span class="o">:</span> <span class="s1">&#39;/_delete_comment&#39;</span><span class="p">,</span>
    <span class="nx">commentImage</span><span class="o">:</span> <span class="s1">&#39;/static/_static/comment.png&#39;</span><span class="p">,</span>
    <span class="nx">closeCommentImage</span><span class="o">:</span> <span class="s1">&#39;/static/_static/comment-close.png&#39;</span><span class="p">,</span>
    <span class="nx">loadingImage</span><span class="o">:</span> <span class="s1">&#39;/static/_static/ajax-loader.gif&#39;</span><span class="p">,</span>
    <span class="nx">commentBrightImage</span><span class="o">:</span> <span class="s1">&#39;/static/_static/comment-bright.png&#39;</span><span class="p">,</span>
    <span class="nx">upArrow</span><span class="o">:</span> <span class="s1">&#39;/static/_static/up.png&#39;</span><span class="p">,</span>
    <span class="nx">downArrow</span><span class="o">:</span> <span class="s1">&#39;/static/_static/down.png&#39;</span><span class="p">,</span>
    <span class="nx">upArrowPressed</span><span class="o">:</span> <span class="s1">&#39;/static/_static/up-pressed.png&#39;</span><span class="p">,</span>
    <span class="nx">downArrowPressed</span><span class="o">:</span> <span class="s1">&#39;/static/_static/down-pressed.png&#39;</span><span class="p">,</span>
    <span class="nx">voting</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="nx">moderator</span><span class="o">:</span> <span class="kc">false</span>
  <span class="p">};</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">COMMENT_OPTIONS</span> <span class="o">!=</span> <span class="s2">&quot;undefined&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">opts</span> <span class="o">=</span> <span class="nx">jQuery</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">opts</span><span class="p">,</span> <span class="nx">COMMENT_OPTIONS</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="kd">var</span> <span class="nx">popupTemplate</span> <span class="o">=</span> <span class="s1">&#39;\</span>
<span class="s1">    &lt;div class=&quot;sphinx-comments&quot; id=&quot;sc&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">      &lt;p class=&quot;sort-options&quot;&gt;\</span>
<span class="s1">        Sort by:\</span>
<span class="s1">        &lt;a href=&quot;#&quot; class=&quot;sort-option byrating&quot;&gt;best rated&lt;/a&gt;\</span>
<span class="s1">        &lt;a href=&quot;#&quot; class=&quot;sort-option byascage&quot;&gt;newest&lt;/a&gt;\</span>
<span class="s1">        &lt;a href=&quot;#&quot; class=&quot;sort-option byage&quot;&gt;oldest&lt;/a&gt;\</span>
<span class="s1">      &lt;/p&gt;\</span>
<span class="s1">      &lt;div class=&quot;comment-header&quot;&gt;Comments&lt;/div&gt;\</span>
<span class="s1">      &lt;div class=&quot;comment-loading&quot; id=&quot;cn&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">        loading comments... &lt;img src=&quot;&lt;%loadingImage%&gt;&quot; alt=&quot;&quot; /&gt;&lt;/div&gt;\</span>
<span class="s1">      &lt;ul id=&quot;cl&lt;%id%&gt;&quot; class=&quot;comment-ul&quot;&gt;&lt;/ul&gt;\</span>
<span class="s1">      &lt;div id=&quot;ca&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">      &lt;p class=&quot;add-a-comment&quot;&gt;Add a comment\</span>
<span class="s1">        (&lt;a href=&quot;#&quot; class=&quot;comment-markup&quot; id=&quot;ab&lt;%id%&gt;&quot;&gt;markup&lt;/a&gt;):&lt;/p&gt;\</span>
<span class="s1">      &lt;div class=&quot;comment-markup-box&quot; id=&quot;mb&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">        reStructured text markup: &lt;i&gt;*emph*&lt;/i&gt;, &lt;b&gt;**strong**&lt;/b&gt;, \</span>
<span class="s1">        &lt;code&gt;``code``&lt;/code&gt;, \</span>
<span class="s1">        code blocks: &lt;code&gt;::&lt;/code&gt; and an indented block after blank line&lt;/div&gt;\</span>
<span class="s1">      &lt;form method=&quot;post&quot; id=&quot;cf&lt;%id%&gt;&quot; class=&quot;comment-form&quot; action=&quot;&quot;&gt;\</span>
<span class="s1">        &lt;textarea name=&quot;comment&quot; cols=&quot;80&quot;&gt;&lt;/textarea&gt;\</span>
<span class="s1">        &lt;p class=&quot;propose-button&quot;&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;pc&lt;%id%&gt;&quot; class=&quot;show-propose-change&quot;&gt;\</span>
<span class="s1">            Propose a change &amp;#9657;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;hc&lt;%id%&gt;&quot; class=&quot;hide-propose-change&quot;&gt;\</span>
<span class="s1">            Propose a change &amp;#9663;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">        &lt;/p&gt;\</span>
<span class="s1">        &lt;textarea name=&quot;proposal&quot; id=&quot;pt&lt;%id%&gt;&quot; cols=&quot;80&quot;\</span>
<span class="s1">                  spellcheck=&quot;false&quot;&gt;&lt;/textarea&gt;\</span>
<span class="s1">        &lt;input type=&quot;submit&quot; value=&quot;Add comment&quot; /&gt;\</span>
<span class="s1">        &lt;input type=&quot;hidden&quot; name=&quot;node&quot; value=&quot;&lt;%id%&gt;&quot; /&gt;\</span>
<span class="s1">        &lt;input type=&quot;hidden&quot; name=&quot;parent&quot; value=&quot;&quot; /&gt;\</span>
<span class="s1">      &lt;/form&gt;\</span>
<span class="s1">      &lt;/div&gt;\</span>
<span class="s1">    &lt;/div&gt;&#39;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">commentTemplate</span> <span class="o">=</span> <span class="s1">&#39;\</span>
<span class="s1">    &lt;div id=&quot;cd&lt;%id%&gt;&quot; class=&quot;sphinx-comment&lt;%css_class%&gt;&quot;&gt;\</span>
<span class="s1">      &lt;div class=&quot;vote&quot;&gt;\</span>
<span class="s1">        &lt;div class=&quot;arrow&quot;&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;uv&lt;%id%&gt;&quot; class=&quot;vote&quot; title=&quot;vote up&quot;&gt;\</span>
<span class="s1">            &lt;img src=&quot;&lt;%upArrow%&gt;&quot; /&gt;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;uu&lt;%id%&gt;&quot; class=&quot;un vote&quot; title=&quot;vote up&quot;&gt;\</span>
<span class="s1">            &lt;img src=&quot;&lt;%upArrowPressed%&gt;&quot; /&gt;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">        &lt;/div&gt;\</span>
<span class="s1">        &lt;div class=&quot;arrow&quot;&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;dv&lt;%id%&gt;&quot; class=&quot;vote&quot; title=&quot;vote down&quot;&gt;\</span>
<span class="s1">            &lt;img src=&quot;&lt;%downArrow%&gt;&quot; id=&quot;da&lt;%id%&gt;&quot; /&gt;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;du&lt;%id%&gt;&quot; class=&quot;un vote&quot; title=&quot;vote down&quot;&gt;\</span>
<span class="s1">            &lt;img src=&quot;&lt;%downArrowPressed%&gt;&quot; /&gt;\</span>
<span class="s1">          &lt;/a&gt;\</span>
<span class="s1">        &lt;/div&gt;\</span>
<span class="s1">      &lt;/div&gt;\</span>
<span class="s1">      &lt;div class=&quot;comment-content&quot;&gt;\</span>
<span class="s1">        &lt;p class=&quot;tagline comment&quot;&gt;\</span>
<span class="s1">          &lt;span class=&quot;user-id&quot;&gt;&lt;%username%&gt;&lt;/span&gt;\</span>
<span class="s1">          &lt;span class=&quot;rating&quot;&gt;&lt;%pretty_rating%&gt;&lt;/span&gt;\</span>
<span class="s1">          &lt;span class=&quot;delta&quot;&gt;&lt;%time.delta%&gt;&lt;/span&gt;\</span>
<span class="s1">        &lt;/p&gt;\</span>
<span class="s1">        &lt;div class=&quot;comment-text comment&quot;&gt;&lt;#text#&gt;&lt;/div&gt;\</span>
<span class="s1">        &lt;p class=&quot;comment-opts comment&quot;&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; class=&quot;reply hidden&quot; id=&quot;rl&lt;%id%&gt;&quot;&gt;reply &amp;#9657;&lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; class=&quot;close-reply&quot; id=&quot;cr&lt;%id%&gt;&quot;&gt;reply &amp;#9663;&lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;sp&lt;%id%&gt;&quot; class=&quot;show-proposal&quot;&gt;proposal &amp;#9657;&lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;hp&lt;%id%&gt;&quot; class=&quot;hide-proposal&quot;&gt;proposal &amp;#9663;&lt;/a&gt;\</span>
<span class="s1">          &lt;a href=&quot;#&quot; id=&quot;dc&lt;%id%&gt;&quot; class=&quot;delete-comment hidden&quot;&gt;delete&lt;/a&gt;\</span>
<span class="s1">          &lt;span id=&quot;cm&lt;%id%&gt;&quot; class=&quot;moderation hidden&quot;&gt;\</span>
<span class="s1">            &lt;a href=&quot;#&quot; id=&quot;ac&lt;%id%&gt;&quot; class=&quot;accept-comment&quot;&gt;accept&lt;/a&gt;\</span>
<span class="s1">          &lt;/span&gt;\</span>
<span class="s1">        &lt;/p&gt;\</span>
<span class="s1">        &lt;pre class=&quot;proposal&quot; id=&quot;pr&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">&lt;#proposal_diff#&gt;\</span>
<span class="s1">        &lt;/pre&gt;\</span>
<span class="s1">          &lt;ul class=&quot;comment-children&quot; id=&quot;cl&lt;%id%&gt;&quot;&gt;&lt;/ul&gt;\</span>
<span class="s1">        &lt;/div&gt;\</span>
<span class="s1">        &lt;div class=&quot;clearleft&quot;&gt;&lt;/div&gt;\</span>
<span class="s1">      &lt;/div&gt;\</span>
<span class="s1">    &lt;/div&gt;&#39;</span><span class="p">;</span>

  <span class="kd">var</span> <span class="nx">replyTemplate</span> <span class="o">=</span> <span class="s1">&#39;\</span>
<span class="s1">    &lt;li&gt;\</span>
<span class="s1">      &lt;div class=&quot;reply-div&quot; id=&quot;rd&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">        &lt;form id=&quot;rf&lt;%id%&gt;&quot;&gt;\</span>
<span class="s1">          &lt;textarea name=&quot;comment&quot; cols=&quot;80&quot;&gt;&lt;/textarea&gt;\</span>
<span class="s1">          &lt;input type=&quot;submit&quot; value=&quot;Add reply&quot; /&gt;\</span>
<span class="s1">          &lt;input type=&quot;button&quot; value=&quot;Cancel&quot; /&gt;\</span>
<span class="s1">          &lt;input type=&quot;hidden&quot; name=&quot;parent&quot; value=&quot;&lt;%id%&gt;&quot; /&gt;\</span>
<span class="s1">          &lt;input type=&quot;hidden&quot; name=&quot;node&quot; value=&quot;&quot; /&gt;\</span>
<span class="s1">        &lt;/form&gt;\</span>
<span class="s1">      &lt;/div&gt;\</span>
<span class="s1">    &lt;/li&gt;&#39;</span><span class="p">;</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-82" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-82'>#</a>
          </div>
          
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">init</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">})(</span><span class="nx">jQuery</span><span class="p">);</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-83" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-83'>#</a>
          </div>
          <p>add comment anchors for all paragraphs that are commentable</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre><span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ready</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>

  <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.sphinx-has-comment&#39;</span><span class="p">).</span><span class="nx">comment</span><span class="p">();</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-84" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-84'>#</a>
          </div>
          <p>highlight search words in search results</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;div.context&quot;</span><span class="p">).</span><span class="nx">each</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">getQueryParameters</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">terms</span> <span class="o">=</span> <span class="p">(</span><span class="nx">params</span><span class="p">.</span><span class="nx">q</span><span class="p">)</span> <span class="o">?</span> <span class="nx">params</span><span class="p">.</span><span class="nx">q</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">split</span><span class="p">(</span><span class="sr">/\s+/</span><span class="p">)</span> <span class="o">:</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

    <span class="nx">$</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">terms</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">result</span><span class="p">.</span><span class="nx">highlightText</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">(),</span> <span class="s1">&#39;highlighted&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span></pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
    <div class='section'>
    <a id="section-85" class="section-anchor"></a>
    <section>
        <div class='docs'>
          <div class='octowrap'>
            <a class='octothorpe' href='#section-85'>#</a>
          </div>
          <p>directly open comment window if requested</p>
        </div>
        <div class='code'>
          <div class="highlight"><pre>  <span class="kd">var</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">anchor</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;#comment-&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#ao&#39;</span> <span class="o">+</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">9</span><span class="p">)).</span><span class="nx">click</span><span class="p">();</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="s1">&#39;#s&#39;</span> <span class="o">+</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">9</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span>

</pre></div>
        </div>
        <div class='clearall'></div>
    </section>
    </div>
  </div>
</body>
