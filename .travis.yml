sudo: required

language: python

services:
      - docker

before_install:
      - docker build -t btcrs/groot .
      - pip install coverage

script:
      - docker run --rm -it -p 8000:8000 -v `pwd`:/code -w /code btcrs/groot /bin/sh -c 'cd ./app && coverage run --source=./ manage.py test'
      - docker run --rm -it -p 8000:8000 -v `pwd`:/code -w /code btcrs/groot /bin/sh -c 'cd ./app && ls'

after_success:
      - test $TRAVIS_BRANCH = "master" && docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"
      - test $TRAVIS_BRANCH = "master" && docker push btcrs/groot
      - docker run --rm -it -p 8000:8000 -v `pwd`:/code -w /code -e COVERALLS_REPO_TOKEN=$COVERALLS btcrs/groot /bin/sh -c 'cd ./app && coveralls'

notifications:
  slack: wevolver:xL4CGDEFEJ6qQeTHMFVk9tEe
